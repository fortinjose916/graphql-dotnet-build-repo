<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-a9a9117b8e5d5893e4cc.js" as="script"/><link rel="preload" href="/component---src-templates-docs-page-js-fc9f7d8d738a0f1f08d6.js" as="script"/><link rel="preload" href="/path---docs-guides-advanced-7530d52b296ad4ae81de.js" as="script"/><link rel="preload" href="/app-d2d05d648416e194693d.js" as="script"/><link rel="preload" href="/commons-98b0a0ce2e8878e93b7b.js" as="script"/><title data-react-helmet="true">GraphQL .NET</title><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" name="keywords" content=""/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><style id="gatsby-inlined-css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt","kern"}img{max-width:100%;margin:0 0 1.45rem;padding:0}h1{font-size:2.25rem}h1,h2{margin:0 0 1.45rem;padding:0;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{margin:0 0 1.45rem;padding:0;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{margin:0 0 1.45rem;padding:0;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{margin:0 0 1.45rem 1.45rem;padding:0;list-style-position:outside;list-style-image:none}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{padding:0;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}pre,table{margin:0 0 1.45rem}table{padding:0;font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{margin:0 0 calc(1.45rem - 1px);padding:0;background:rgba(0,0,0,.2);border:none;height:1px}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:0;padding-top:.2em;padding-bottom:.2em}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#073642}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}html{color:#2c3e50}body,html{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;font-size:16px;overflow:auto}body{margin:0}#___gatsby{overflow:auto}ul{padding:0}li,ul{margin:0}li{white-space:nowrap}a{color:#3eaf7c;text-decoration:underline}.header{height:60px;border-bottom:1px solid #eaecef}.header ul{padding:20px}.header li{list-style:none;display:inline-block;padding:0 12px}.header li a{color:#2c3e50;text-decoration:none}.footer{height:60px}.footer,.header{-ms-flex:none;flex:none}.page-body{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;height:calc(100% - 60px)}.content{height:100%;width:100%;overflow-y:hidden;overflow-x:hidden;padding:2em}.content ul{margin:20px 0}.content ul li{margin:0 0 0 30px}.content blockquote{padding-left:10px;border-left:5px solid #eaecef;margin:0 0 15px}.content pre{margin-bottom:1.45rem}.nav{padding-top:2rem;-ms-flex-order:1;order:1;overflow-y:inherit;overflow-x:hidden;-ms-flex-positive:1;flex-grow:1;border:0;min-width:250px}.nav li{list-style:none}.nav li span{padding:.25rem 1rem .25rem 1.5rem;font-weight:600;display:block}.nav ul{margin-bottom:15px}.nav ul a{color:#2c3e50;padding:.25rem 1rem .25rem 1.25rem;border-left:.25rem solid transparent;display:inline-block;text-decoration:none;line-height:1.4}.nav ul a:hover{color:#3eaf7c}.nav ul a.active{color:#3eaf7c;border-left:.25rem solid #3eaf7c;text-decoration:none}@media (min-width:768px){#___gatsby,body,html{height:100%;overflow-y:hidden}.page-body{-ms-flex-direction:row;flex-direction:row}.content{overflow-y:auto}.ads,.nav{-ms-flex-order:-1;order:-1}.nav{overflow-y:auto;border-right:1px solid #eaecef}}.landing{margin:1.8rem auto}</style></head><body><div id="___gatsby"><nav class="header"><ul><li><a href="/">GraphQL .NET</a></li><li><a href="/docs/getting-started/introduction">Docs</a></li><li><a href="https://github.com/graphql-dotnet/graphql-dotnet" rel="noopener noreferrer" target="_blank">Github</a></li></ul></nav><div class="page-body"><article class="content"><h1 id="advanced-topics"><a href="#advanced-topics" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Advanced Topics</h1>
<h2 id="error-handling"><a href="#error-handling" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Error Handling</h2>
<p>The <code class="language-text">ExecutionResult</code> provides an <code class="language-text">Errors</code> property which includes any errors encountered during exectution.  Errors are returned <a href="http://facebook.github.io/graphql/#sec-Errors">according to the spec</a>, which means stack traces are excluded.  The <code class="language-text">ExecutionResult</code> is transformed to what the spec requires using JSON.NET.  You can change what information is provided by overriding the JSON Converter.</p>
<p>You can provide additional error handling or logging for fields by adding Field Middleware.</p>
<h2 id="user-context"><a href="#user-context" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>User Context</h2>
<p>You can provide a <code class="language-text">UserContext</code> to provide access to your specific data.  The <code class="language-text">UserContext</code> is accessible in field resolvers and validation rules.</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GraphQLUserContext</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> _executer<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span>_ <span class="token operator">=</span><span class="token operator">></span>
<span class="token punctuation">{</span>
    _<span class="token punctuation">.</span>UserContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLUserContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ConfigureAwait</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Field<span class="token operator">&lt;</span>ListGraphType<span class="token operator">&lt;</span>DinnerType<span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span>
    <span class="token string">"popularDinners"</span><span class="token punctuation">,</span>
    resolve<span class="token punctuation">:</span> context <span class="token operator">=</span><span class="token operator">></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> userContext <span class="token operator">=</span> context<span class="token punctuation">.</span>UserContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token punctuation">&lt;</span><span class="token class-name">GraphQLUserContext</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<h2 id="dependency-injection"><a href="#dependency-injection" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependency Injection</h2>
<p>GraphQL .NET supports dependency injection through a simple resolve function on the Schema class.  Internally when trying to resolve a type the library will call this resolve function.</p>
<p>The default implementation uses <code class="language-text">Activator.CreateInstance</code>.</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp">type <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>GraphType<span class="token punctuation">)</span> Activator<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span></code></pre>
      </div>
<p>How you integrate this into your system will depend on the dependency injection framework you are using.  Registering your schema with a resolve function that accesses your container may look something like this:</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token comment">// Nancy TinyIoCContainer</span>
container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> overloads<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NerdDinnerSchema</span><span class="token punctuation">(</span>type <span class="token operator">=</span><span class="token operator">></span> c<span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token keyword">as</span> IGraphType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// SimpleContainer</span>
<span class="token keyword">var</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span><span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StarWarsSchema</span><span class="token punctuation">(</span>type <span class="token operator">=</span><span class="token operator">></span> container<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token keyword">as</span> IGraphType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p><a href="https://github.com/graphql-dotnet/graphql-dotnet/blob/master/src/GraphQL.GraphiQL/Bootstrapper.cs">The GraphiQL sample application uses Dependency Injection.</a></p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NerdDinnerSchema</span> <span class="token punctuation">:</span> <span class="token class-name">GraphQL<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>Schema</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">NerdDinnerSchema</span><span class="token punctuation">(</span>Func<span class="token operator">&lt;</span>Type<span class="token punctuation">,</span> IGraphType<span class="token operator">></span> resolve<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Query <span class="token operator">=</span> <span class="token punctuation">(</span>IObjectGraphType<span class="token punctuation">)</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>Query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mutation <span class="token operator">=</span> <span class="token punctuation">(</span>IObjectGraphType<span class="token punctuation">)</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>Mutation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<h2 id="objectfield-metadata"><a href="#objectfield-metadata" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Object/Field Metadata</h2>
<p><code class="language-text">GraphType</code> and <code class="language-text">FieldType</code> implement the <code class="language-text">IProvideMetadata</code> interface.  This allows you to add arbitrary information to a field or graph type.  This can be useful in combination with a validation rule or field middleware.</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IProvideMetadata</span>
<span class="token punctuation">{</span>
    IDictionary<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token operator">></span> Metadata <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    TType <span class="token generic-method"><span class="token function">GetMetadata</span><span class="token punctuation">&lt;</span><span class="token class-name">TType</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">string</span> key<span class="token punctuation">,</span> <span class="token class-name">TType</span> defaultValue <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">(</span>TType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> <span class="token function">HasMetadata</span><span class="token punctuation">(</span><span class="token keyword">string</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<h2 id="field-middleware"><a href="#field-middleware" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Field Middleware</h2>
<p>You can write middleware for fields to provide additional behaviors during field resolution.  The following example is how Metrics are captured.  You register Field Middleware in the <code class="language-text">ExecutionOptions</code>.</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> _executer<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span>_ <span class="token operator">=</span><span class="token operator">></span>
<span class="token punctuation">{</span>
    _<span class="token punctuation">.</span>Schema <span class="token operator">=</span> _schema<span class="token punctuation">;</span>
    _<span class="token punctuation">.</span>Query <span class="token operator">=</span> queryToExecute<span class="token punctuation">;</span>

    _<span class="token punctuation">.</span>FieldMiddleware<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Use</span><span class="token punctuation">&lt;</span><span class="token class-name">InstrumentFieldsMiddleware</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ConfigureAwait</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<p>You can write a class that has a <code class="language-text">Resolve</code> method or you can register a middleware delegate directly.</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InstrumentFieldsMiddleware</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> Task<span class="token operator">&lt;</span><span class="token keyword">object</span><span class="token operator">></span> <span class="token function">Resolve</span><span class="token punctuation">(</span>
        <span class="token class-name">ResolveFieldContext</span> context<span class="token punctuation">,</span>
        <span class="token class-name">FieldMiddlewareDelegate</span> next<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> metadata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dictionary</span><span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token operator">></span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">{</span><span class="token string">"typeName"</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>ParentType<span class="token punctuation">.</span>Name<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token string">"fieldName"</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>FieldName<span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">using</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>Metrics<span class="token punctuation">.</span><span class="token function">Subject</span><span class="token punctuation">(</span><span class="token string">"field"</span><span class="token punctuation">,</span> context<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> metadata<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>The middleware delegate is defined as:</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">delegate</span> Task<span class="token operator">&lt;</span><span class="token keyword">object</span><span class="token operator">></span> <span class="token function">FieldMiddlewareDelegate</span><span class="token punctuation">(</span><span class="token class-name">ResolveFieldContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp">_<span class="token punctuation">.</span>FieldMiddleware<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>next <span class="token operator">=</span><span class="token operator">></span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> context <span class="token operator">=</span><span class="token operator">></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<h2 id="authentication--authorization"><a href="#authentication--authorization" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Authentication / Authorization</h2>
<p>See the <a href="https://github.com/graphql-dotnet/authorization">Authorization</a> project for an implemenation of the following.</p>
<p>You can write validation rules that will run before the query is executed.  You can use this pattern to check that the user is authenticated or has permissions for a specific field.  This example uses the <code class="language-text">Metadata</code> dictionary available on Fields to set permissons per field.</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequiresAuthValidationRule</span> <span class="token punctuation">:</span> <span class="token class-name">IValidationRule</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">INodeVisitor</span> <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token class-name">ValidationContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> userContext <span class="token operator">=</span> context<span class="token punctuation">.</span>UserContext<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token punctuation">&lt;</span><span class="token class-name">GraphQLUserContext</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> authenticated <span class="token operator">=</span> userContext<span class="token punctuation">.</span>User<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">IsAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">false</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EnterLeaveListener</span><span class="token punctuation">(</span>_ <span class="token operator">=</span><span class="token operator">></span>
        <span class="token punctuation">{</span>
            _<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Match</span><span class="token punctuation">&lt;</span><span class="token class-name">Operation</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>op <span class="token operator">=</span><span class="token operator">></span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">.</span>OperationType <span class="token operator">==</span> OperationType<span class="token punctuation">.</span>Mutation <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>authenticated<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    context<span class="token punctuation">.</span><span class="token function">ReportError</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ValidationError</span><span class="token punctuation">(</span>
                        context<span class="token punctuation">.</span>OriginalQuery<span class="token punctuation">,</span>
                        <span class="token string">"auth-required"</span><span class="token punctuation">,</span>
                        $<span class="token string">"Authorization is required to access {op.Name}."</span><span class="token punctuation">,</span>
                        op<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// this could leak info about hidden fields in error messages</span>
            <span class="token comment">// it would be better to implement a filter on the schema so it</span>
            <span class="token comment">// acts as if they just don't exist vs. an auth denied error</span>
            <span class="token comment">// - filtering the schema is not currently supported</span>
            _<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Match</span><span class="token punctuation">&lt;</span><span class="token class-name">Field</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>fieldAst <span class="token operator">=</span><span class="token operator">></span>
            <span class="token punctuation">{</span>
                <span class="token keyword">var</span> fieldDef <span class="token operator">=</span> context<span class="token punctuation">.</span>TypeInfo<span class="token punctuation">.</span><span class="token function">GetFieldDef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>fieldDef<span class="token punctuation">.</span><span class="token function">RequiresPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token operator">!</span>authenticated <span class="token operator">||</span> <span class="token operator">!</span>fieldDef<span class="token punctuation">.</span><span class="token function">CanAccess</span><span class="token punctuation">(</span>userContext<span class="token punctuation">.</span>User<span class="token punctuation">.</span>Claims<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    context<span class="token punctuation">.</span><span class="token function">ReportError</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ValidationError</span><span class="token punctuation">(</span>
                        context<span class="token punctuation">.</span>OriginalQuery<span class="token punctuation">,</span>
                        <span class="token string">"auth-required"</span><span class="token punctuation">,</span>
                        $<span class="token string">"You are not authorized to run this query."</span><span class="token punctuation">,</span>
                        fieldAst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<h3 id="permission-extension-methods"><a href="#permission-extension-methods" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Permission Extension Methods</h3>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token function">Field</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">></span> x<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddPermission</span><span class="token punctuation">(</span><span class="token string">"Some permission"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GraphQLExtensions</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token keyword">string</span> PermissionsKey <span class="token operator">=</span> <span class="token string">"Permissions"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">RequiresPermissions</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IProvideMetadata</span> type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> permissions <span class="token operator">=</span> type<span class="token punctuation">.</span>GetMetadata<span class="token operator">&lt;</span>IEnumerable<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span>PermissionsKey<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> permissions<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">CanAccess</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IProvideMetadata</span> type<span class="token punctuation">,</span> IEnumerable<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span> claims<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> permissions <span class="token operator">=</span> type<span class="token punctuation">.</span>GetMetadata<span class="token operator">&lt;</span>IEnumerable<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span>PermissionsKey<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> permissions<span class="token punctuation">.</span><span class="token function">All</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">></span> claims<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">HasPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IProvideMetadata</span> type<span class="token punctuation">,</span> <span class="token keyword">string</span> permission<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> permissions <span class="token operator">=</span> type<span class="token punctuation">.</span>GetMetadata<span class="token operator">&lt;</span>IEnumerable<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span>PermissionsKey<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> permissions<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> permission<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">AddPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IProvideMetadata</span> type<span class="token punctuation">,</span> <span class="token keyword">string</span> permission<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> permissions <span class="token operator">=</span> type<span class="token punctuation">.</span>GetMetadata<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span>PermissionsKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>permissions <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            permissions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            type<span class="token punctuation">.</span>Metadata<span class="token punctuation">[</span><span class="token class-name">PermissionsKey</span><span class="token punctuation">]</span> <span class="token operator">=</span> permissions<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        permissions<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> FieldBuilder<span class="token operator">&lt;</span>TSourceType<span class="token punctuation">,</span> TReturnType<span class="token operator">></span> <span class="token generic-method"><span class="token function">AddPermission</span><span class="token punctuation">&lt;</span><span class="token class-name">TSourceType</span><span class="token punctuation">,</span> <span class="token class-name">TReturnType</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        <span class="token keyword">this</span> FieldBuilder<span class="token operator">&lt;</span>TSourceType<span class="token punctuation">,</span> TReturnType<span class="token operator">></span> builder<span class="token punctuation">,</span> <span class="token keyword">string</span> permission<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span>FieldType<span class="token punctuation">.</span><span class="token function">AddPermission</span><span class="token punctuation">(</span>permission<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> builder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<h2 id="protection-against-malicious-queries"><a href="#protection-against-malicious-queries" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Protection Against Malicious Queries</h2>
<p>GraphQL allows the client to bundle and nest many queries into a single request. While this is quite convenient it also makes GraphQL endpoints susceptible to Denial of Service attacks.</p>
<p>To mitigate this graphql-dotnet provides a few options that can be tweaked to set the upper bound of nesting and complexity of incoming queries so that the endpoint would only try to resolve queries that meet the set criteria and discard any overly complex and possibly malicious query that you don't expect your clients to make thus protecting your server resources against depletion by a denial of service attacks.</p>
<p>These options are passed to the <code class="language-text">DocumentExecutor.ExecuteAsync(...)</code> via an instance of <code class="language-text">GraphQL.Validation.Complexity.ComplexityConfiguration</code> <sub><sup><a href="https://github.com/graphql-dotnet/graphql-dotnet/blob/master/src/GraphQL.GraphiQL/Controllers/GraphQLController.cs#L62"><em>(click here for an example)</em></a></sup></sub>. You can leave any of the options null to go with the default value and disable that specific test. The available options are the following:</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">int</span><span class="token operator">?</span> MaxDepth <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">int</span><span class="token operator">?</span> MaxComplexity <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">double</span><span class="token operator">?</span> FieldImpact <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre>
      </div>
<p><code class="language-text">MaxDepth</code> will enforce the total maximum nesting across all queries in a request. For example the following query will have a query depth of 2. Note that fragments are taken into consideration when making these calculations.</p>
<div class="gatsby-highlight" data-language="graphql">
      <pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span>
  Product <span class="token punctuation">{</span>  <span class="token comment"># This query has a depth of 2 which loosely translates to two distinct queries</span>
  			 <span class="token comment"># to the datasource, first one to return the list of products and second</span>
             <span class="token comment"># one (which will be executed once for each returned product) to grab</span>
             <span class="token comment"># the product's first 3 locations.</span>
    Title
    <span class="token operator">...</span>X  <span class="token comment"># The depth of this fragment is calculated first and added to the total.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fragment</span> X on Product <span class="token punctuation">{</span> <span class="token comment"># This fragment has a depth of only 1.</span>
  Location<span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lat
    long
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>The query depth setting is a good estimation of complexity for most use cases and it loosely translates to the number of unique queries sent to the datastore (however it does not look at how many times each query might get executed). Keep in mind that the calculation of complexity needs to be FAST otherwise it can impose a significant overhead.</p>
<p>One step further would be specifying <code class="language-text">MaxComplexity</code> and <code class="language-text">FieldImpact</code> to look at the estimated number of entities (or cells in a database) that are expected to be returned by each query. Obviously this depends on the size of your database (i.e. number of records per entity) so you will need to find the average number of records per database entity and input that into <code class="language-text">FieldImpact</code>. For example if I have 3 tables with 100, 120 and 98 rows and I know I will be querying the first table twice as much then a good estimation for <code class="language-text">avgImpact</code> would be 105.</p>
<p>Note: I highly recommend setting a higher bound on the number of returned entities by each resolve function in your code. if you use this approach already in your code then you can input that upper bound (which would be the maximum possible items returned per entity) as your avgImpact.
It is also possilbe to use a theorical value for this (for example 2.0) to asses the query's impact on a theorical database hence decoupling this calculation from your actual database.</p>
<p>Imagine if we had a simple test database for the query in the previous example and we assume an average impact of 2.0 (each entity will return ~2 results) then we can calculate the complexity as following:</p>
<div class="gatsby-highlight" data-language="math">
      <pre class="language-math"><code class="language-math">2 Products returned + 2 * (1 * Title per Product) + 2 * [ (3 * Locations) + (3 * lat entries) + (3 * long entries) ] = **22**</code></pre>
      </div>
<p>Or simply put on average we will have <strong>2x Products</strong> each will have 1 Title for a total of <strong>2x Titles</strong> plus per each Product entry we will have 3 locations overriden by <code class="language-text">first</code> argument (we follow relay's spec for <code class="language-text">first</code>,<code class="language-text">last</code> and <code class="language-text">id</code> arguments) and each of these 3 locations have a lat and a long totalling <strong>6x Locations</strong> having <strong>6x lat</strong>s and <strong>6x longs</strong>.</p>
<p>Now if we set the <code class="language-text">avgImpact</code> to 2.0 and set the <code class="language-text">MaxComplexity</code> to 23 (or higher) the query will execute correctly. If we change the <code class="language-text">MaxComplexity</code> to something like 20 the DocumentExecutor will fail right after parsing the AST tree and will not attempt to resolve any of the fields (or talk to the database).</p>
<h2 id="metrics"><a href="#metrics" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Metrics</h2>
<p>Metrics are captured during execution.  This can help you determine performance issues within a resolver or validation.  Field metrics are captured using Field Middleware and the results are returned as a <code class="language-text">PerfRecord</code> array on the <code class="language-text">ExecutionResult</code>.  You can then generate a report from those records using <code class="language-text">StatsReport</code>.</p>
<div class="gatsby-highlight" data-language="csharp">
      <pre class="language-csharp"><code class="language-csharp"><span class="token keyword">var</span> start <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>UtcNow<span class="token punctuation">;</span>

<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> _executer<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span> _ <span class="token operator">=</span><span class="token operator">></span>
    _<span class="token punctuation">.</span>FieldMiddleware<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Use</span><span class="token punctuation">&lt;</span><span class="token class-name">InstrumentFieldsMiddleware</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> report <span class="token operator">=</span> StatsReport<span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> result<span class="token punctuation">.</span>Operation<span class="token punctuation">,</span> result<span class="token punctuation">.</span>Perf<span class="token punctuation">,</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
      </div>
<h2 id="relay"><a href="#relay" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Relay</h2>
<p>The core project provides a few classes to help with Relay.  You can find more types and helpers <a href="https://github.com/graphql-dotnet/relay">here</a>.</p>
<p>(Example needed)</p></article><div class="nav"><nav><ul><li><span>Getting Started</span><nav><ul><li><a class="" href="/docs/getting-started/introduction">Introduction</a></li><li><a class="" href="/docs/getting-started/installation">Installation</a></li></ul></nav></li><li><span>Guides</span><nav><ul><li><a class="" href="/docs/guides/dataloader">Dataloader</a></li><li><a class="active" href="/docs/guides/advanced">Advanced Topics</a></li></ul></nav></li></ul></nav></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-d2d05d648416e194693d.js","95710047193689":"component---site-pages-landing-js-7a04f3721ec3f8b3df00.js","28613242278168":"component---src-templates-docs-page-js-fc9f7d8d738a0f1f08d6.js","162898551421021":"component---src-pages-404-js-4503918ea3a16cfcdb75.js","60335399758886":"path----5303e5d5c09b56dd350d.js","142629428675168":"path---index-6b1dcdab0a774a86ff50.js","194669561623365":"path---docs-getting-started-introduction-d746cde4395dc582bfc9.js","7936910712040":"path---docs-getting-started-installation-ff9a29f8cffcc0b6789e.js","67274500541493":"path---docs-guides-dataloader-bc8e11d56a77a9ae2c10.js","230763194466861":"path---docs-guides-advanced-7530d52b296ad4ae81de.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-a9a9117b8e5d5893e4cc.js"}/*]]>*/</script><script>/*<![CDATA[*/["/commons-98b0a0ce2e8878e93b7b.js","/app-d2d05d648416e194693d.js","/path---docs-guides-advanced-7530d52b296ad4ae81de.js","/component---src-templates-docs-page-js-fc9f7d8d738a0f1f08d6.js","/component---src-layouts-index-js-a9a9117b8e5d5893e4cc.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>